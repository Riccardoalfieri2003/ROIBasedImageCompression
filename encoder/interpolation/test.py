from encoder.interpolation.spline import compress_shape_divided_exact, get_minimal_storage_with_rounding
from encoder.interpolation.visualization import print_divided_compression_analysis, visualize_divided_compression, visualize_minimal_storage_results, visualize_reconstruction_comparison, visualize_reconstruction_overlay, visualize_quality_metrics
from encoder.interpolation.reconstruct import reconstruct_from_minimal_storage,save_compressed_matrix, load_and_reconstruct, analyze_final_storage
import numpy as np

if __name__ == "__main__":
    # Your sample coordinates (replace with your actual problematic data)
    sample_coordinates =[  (661.5,510.0),  (661.5,509.0),  (661.0,508.5),  (660.5,508.0),  (660.5,507.0), 
  (660.5,506.0),  (660.5,505.0),  (660.0,504.5),  (659.0,504.5),  (658.0,504.5), 
  (657.5,505.0),  (657.0,505.5),  (656.0,505.5),  (655.0,505.5),  (654.5,506.0), 
  (654.0,506.5),  (653.5,507.0),  (653.0,507.5),  (652.0,507.5),  (651.5,508.0), 
  (651.0,508.5),  (650.5,509.0),  (650.5,510.0),  (650.0,510.5),  (649.5,511.0), 
  (649.5,512.0),  (649.5,513.0),  (649.5,514.0),  (649.5,515.0),  (649.5,516.0), 
  (649.5,517.0),  (650.0,517.5),  (650.5,518.0),  (650.5,519.0),  (650.0,519.5), 
  (649.5,520.0),  (649.5,521.0),  (649.5,522.0),  (649.0,522.5),  (648.0,522.5), 
  (647.0,522.5),  (646.0,522.5),  (645.0,522.5),  (644.0,522.5),  (643.5,522.0), 
  (643.0,521.5),  (642.0,521.5),  (641.0,521.5),  (640.0,521.5),  (639.5,522.0), 
  (639.0,522.5),  (638.0,522.5),  (637.0,522.5),  (636.5,523.0),  (636.0,523.5), 
  (635.0,523.5),  (634.0,523.5),  (633.0,523.5),  (632.5,524.0),  (632.5,525.0), 
  (632.5,526.0),  (632.5,527.0),  (632.0,527.5),  (631.5,528.0),  (631.0,528.5), 
  (630.5,529.0),  (630.5,530.0),  (630.0,530.5),  (629.5,531.0),  (629.5,532.0), 
  (629.5,533.0),  (629.5,534.0),  (629.5,535.0),  (629.5,536.0),  (629.0,536.5), 
  (628.5,537.0),  (628.5,538.0),  (628.0,538.5),  (627.5,539.0),  (627.0,539.5), 
  (626.0,539.5),  (625.0,539.5),  (624.0,539.5),  (623.0,539.5),  (622.0,539.5), 
  (621.5,539.0),  (621.5,538.0),  (622.0,537.5),  (622.5,538.0),  (623.0,538.5), 
  (623.5,538.0),  (624.0,537.5),  (624.5,537.0),  (624.5,536.0),  (625.0,535.5), 
  (625.5,535.0),  (625.5,534.0),  (625.5,533.0),  (625.5,532.0),  (625.5,531.0), 
  (625.5,530.0),  (625.5,529.0),  (625.5,528.0),  (625.5,527.0),  (626.0,526.5), 
  (626.5,526.0),  (626.5,525.0),  (626.5,524.0),  (627.0,523.5),  (627.5,523.0), 
  (627.5,522.0),  (628.0,521.5),  (628.5,521.0),  (629.0,520.5),  (629.5,520.0), 
  (629.5,519.0),  (629.5,518.0),  (629.5,517.0),  (629.5,516.0),  (629.0,515.5), 
  (628.5,515.0),  (628.5,514.0),  (628.0,513.5),  (627.5,513.0),  (627.5,512.0), 
  (627.0,511.5),  (626.5,511.0),  (626.5,510.0),  (626.5,509.0),  (626.5,508.0), 
  (626.5,507.0),  (626.5,506.0),  (626.0,505.5),  (625.5,505.0),  (625.5,504.0), 
  (625.5,503.0),  (625.5,502.0),  (625.5,501.0),  (625.5,500.0),  (625.5,499.0), 
  (626.0,498.5),  (626.5,498.0),  (626.5,497.0),  (626.5,496.0),  (627.0,495.5), 
  (627.5,495.0),  (627.5,494.0),  (627.5,493.0),  (627.5,492.0),  (628.0,491.5), 
  (628.5,491.0),  (628.5,490.0),  (628.5,489.0),  (628.5,488.0),  (628.5,487.0), 
  (629.0,486.5),  (629.5,486.0),  (629.5,485.0),  (629.5,484.0),  (630.0,483.5), 
  (630.5,483.0),  (630.5,482.0),  (630.5,481.0),  (631.0,480.5),  (631.5,480.0), 
  (631.5,479.0),  (631.5,478.0),  (632.0,477.5),  (632.5,477.0),  (632.5,476.0), 
  (633.0,475.5),  (633.5,475.0),  (633.5,474.0),  (633.5,473.0),  (633.5,472.0), 
  (633.5,471.0),  (633.5,470.0),  (633.5,469.0),  (633.5,468.0),  (633.5,467.0), 
  (633.5,466.0),  (633.5,465.0),  (633.5,464.0),  (633.5,463.0),  (633.5,462.0), 
  (634.0,461.5),  (634.5,461.0),  (635.0,460.5),  (635.5,460.0),  (636.0,459.5), 
  (636.5,459.0),  (636.5,458.0),  (636.5,457.0),  (636.5,456.0),  (636.5,455.0), 
  (636.5,454.0),  (636.0,453.5),  (635.5,453.0),  (635.5,452.0),  (635.5,451.0), 
  (635.0,450.5),  (634.5,450.0),  (634.5,449.0),  (634.5,448.0),  (634.5,447.0), 
  (634.5,446.0),  (634.5,445.0),  (634.5,444.0),  (634.5,443.0),  (634.0,442.5), 
  (633.5,442.0),  (633.0,441.5),  (632.0,441.5),  (631.5,441.0),  (631.0,440.5), 
  (630.0,440.5),  (629.5,441.0),  (629.0,441.5),  (628.5,442.0),  (628.0,442.5), 
  (627.0,442.5),  (626.5,442.0),  (626.0,441.5),  (625.0,441.5),  (624.0,441.5), 
  (623.0,441.5),  (622.0,441.5),  (621.0,441.5),  (620.5,442.0),  (620.0,442.5), 
  (619.0,442.5),  (618.0,442.5),  (617.0,442.5),  (616.0,442.5),  (615.5,442.0), 
  (615.0,441.5),  (614.0,441.5),  (613.5,441.0),  (613.0,440.5),  (612.5,440.0), 
  (612.0,439.5),  (611.0,439.5),  (610.0,439.5),  (609.0,439.5),  (608.0,439.5), 
  (607.5,439.0),  (607.0,438.5),  (606.0,438.5),  (605.0,438.5),  (604.5,438.0), 
  (604.0,437.5),  (603.5,437.0),  (603.0,436.5),  (602.0,436.5),  (601.0,436.5), 
  (600.5,436.0),  (600.0,435.5),  (599.0,435.5),  (598.0,435.5),  (597.0,435.5), 
  (596.5,436.0),  (596.0,436.5),  (595.5,437.0),  (595.0,437.5),  (594.5,438.0), 
  (594.0,438.5),  (593.5,439.0),  (593.0,439.5),  (592.0,439.5),  (591.5,440.0), 
  (591.0,440.5),  (590.5,441.0),  (590.0,441.5),  (589.0,441.5),  (588.5,441.0), 
  (588.5,440.0),  (588.5,439.0),  (588.5,438.0),  (588.0,437.5),  (587.5,437.0), 
  (587.0,436.5),  (586.5,436.0),  (586.0,435.5),  (585.5,436.0),  (585.5,437.0), 
  (585.5,438.0),  (585.5,439.0),  (585.5,440.0),  (585.0,440.5),  (584.0,440.5), 
  (583.5,440.0),  (583.0,439.5),  (582.5,439.0),  (582.0,438.5),  (581.0,438.5), 
  (580.0,438.5),  (579.0,438.5),  (578.5,438.0),  (578.0,437.5),  (577.5,437.0), 
  (578.0,436.5),  (578.5,436.0),  (578.5,435.0),  (578.0,434.5),  (577.5,434.0), 
  (577.5,433.0),  (577.5,432.0),  (577.5,431.0),  (578.0,430.5),  (579.0,430.5), 
  (580.0,430.5),  (580.5,431.0),  (581.0,431.5),  (581.5,431.0),  (581.5,430.0), 
  (581.5,429.0),  (581.5,428.0),  (581.5,427.0),  (581.0,426.5),  (580.5,427.0), 
  (580.0,427.5),  (579.5,428.0),  (579.0,428.5),  (578.0,428.5),  (577.5,428.0), 
  (577.0,427.5),  (576.0,427.5),  (575.5,428.0),  (575.0,428.5),  (574.5,429.0), 
  (574.0,429.5),  (573.0,429.5),  (572.5,430.0),  (572.0,430.5),  (571.0,430.5), 
  (570.0,430.5),  (569.0,430.5),  (568.0,430.5),  (567.5,431.0),  (567.0,431.5), 
  (566.0,431.5),  (565.5,431.0),  (565.5,430.0),  (566.0,429.5),  (566.5,429.0), 
  (566.0,428.5),  (565.0,428.5),  (564.5,429.0),  (564.0,429.5),  (563.5,430.0), 
  (563.0,430.5),  (562.0,430.5),  (561.5,431.0),  (561.0,431.5),  (560.0,431.5), 
  (559.0,431.5),  (558.5,432.0),  (558.0,432.5),  (557.0,432.5),  (556.0,432.5), 
  (555.5,433.0),  (555.0,433.5),  (554.5,434.0),  (554.0,434.5),  (553.5,435.0), 
  (553.0,435.5),  (552.5,436.0),  (552.0,436.5),  (551.0,436.5),  (550.0,436.5), 
  (549.0,436.5),  (548.5,437.0),  (548.0,437.5),  (547.0,437.5),  (546.5,438.0), 
  (546.0,438.5),  (545.0,438.5),  (544.0,438.5),  (543.0,438.5),  (542.5,439.0), 
  (542.0,439.5),  (541.5,439.0),  (541.0,438.5),  (540.5,438.0),  (540.0,437.5), 
  (539.5,438.0),  (539.0,438.5),  (538.5,439.0),  (539.0,439.5),  (539.5,440.0), 
  (539.5,441.0),  (540.0,441.5),  (540.5,442.0),  (540.5,443.0),  (540.0,443.5), 
  (539.5,444.0),  (539.5,445.0),  (539.5,446.0),  (539.5,447.0),  (539.5,448.0), 
  (539.0,448.5),  (538.5,449.0),  (538.5,450.0),  (538.0,450.5),  (537.0,450.5), 
  (536.5,451.0),  (536.0,451.5),  (535.5,452.0),  (535.0,452.5),  (534.5,453.0), 
  (534.5,454.0),  (534.0,454.5),  (533.5,455.0),  (533.0,455.5),  (532.0,455.5), 
  (531.5,456.0),  (531.0,456.5),  (530.5,457.0),  (530.0,457.5),  (529.0,457.5), 
  (528.0,457.5),  (527.5,457.0),  (527.0,456.5),  (526.5,456.0),  (526.5,455.0), 
  (526.5,454.0),  (526.0,453.5),  (525.5,453.0),  (525.5,452.0),  (525.0,451.5), 
  (524.5,451.0),  (524.5,450.0),  (524.0,449.5),  (523.5,449.0),  (523.5,448.0), 
  (523.0,447.5),  (522.5,447.0),  (522.0,446.5),  (521.5,446.0),  (521.0,445.5), 
  (520.0,445.5),  (519.0,445.5),  (518.0,445.5),  (517.0,445.5),  (516.0,445.5), 
  (515.0,445.5),  (514.0,445.5),  (513.5,445.0),  (513.0,444.5),  (512.5,445.0), 
  (512.0,445.5),  (511.5,446.0),  (511.5,447.0),  (512.0,447.5),  (513.0,447.5), 
  (513.5,448.0),  (513.5,449.0),  (513.5,450.0),  (513.5,451.0),  (513.5,452.0), 
  (514.0,452.5),  (514.5,453.0),  (514.0,453.5),  (513.0,453.5),  (512.5,453.0), 
  (512.0,452.5),  (511.5,452.0),  (511.5,451.0),  (511.0,450.5),  (510.5,450.0), 
  (510.5,449.0),  (510.0,448.5),  (509.5,449.0),  (509.0,449.5),  (508.5,450.0), 
  (508.5,451.0),  (508.5,452.0),  (508.5,453.0),  (508.5,454.0),  (509.0,454.5), 
  (509.5,455.0),  (509.5,456.0),  (510.0,456.5),  (511.0,456.5),  (512.0,456.5), 
  (512.5,457.0),  (513.0,457.5),  (514.0,457.5),  (514.5,458.0),  (515.0,458.5), 
  (515.5,459.0),  (515.5,460.0),  (516.0,460.5),  (516.5,461.0),  (517.0,461.5), 
  (517.5,462.0),  (518.0,462.5),  (518.5,463.0),  (519.0,463.5),  (520.0,463.5), 
  (521.0,463.5),  (521.5,463.0),  (521.5,462.0),  (522.0,461.5),  (522.5,461.0), 
  (523.0,460.5),  (523.5,461.0),  (523.5,462.0),  (523.5,463.0),  (523.5,464.0), 
  (524.0,464.5),  (525.0,464.5),  (525.5,465.0),  (526.0,465.5),  (527.0,465.5), 
  (527.5,466.0),  (528.0,466.5),  (528.5,467.0),  (528.5,468.0),  (528.5,469.0), 
  (528.5,470.0),  (528.5,471.0),  (528.5,472.0),  (528.5,473.0),  (528.5,474.0), 
  (528.5,475.0),  (529.0,475.5),  (529.5,476.0),  (529.5,477.0),  (529.0,477.5), 
  (528.5,478.0),  (528.5,479.0),  (528.0,479.5),  (527.5,480.0),  (527.0,480.5), 
  (526.0,480.5),  (525.5,481.0),  (525.0,481.5),  (524.0,481.5),  (523.5,482.0), 
  (523.0,482.5),  (522.5,483.0),  (522.5,484.0),  (522.5,485.0),  (522.0,485.5), 
  (521.0,485.5),  (520.5,486.0),  (520.5,487.0),  (521.0,487.5),  (522.0,487.5), 
  (522.5,488.0),  (523.0,488.5),  (524.0,488.5),  (525.0,488.5),  (526.0,488.5), 
  (527.0,488.5),  (528.0,488.5),  (528.5,489.0),  (529.0,489.5),  (529.5,490.0), 
  (529.5,491.0),  (530.0,491.5),  (530.5,492.0),  (530.5,493.0),  (530.5,494.0), 
  (530.0,494.5),  (529.5,495.0),  (529.0,495.5),  (528.5,496.0),  (528.5,497.0), 
  (528.5,498.0),  (528.5,499.0),  (528.5,500.0),  (528.0,500.5),  (527.5,501.0), 
  (527.5,502.0),  (527.5,503.0),  (527.0,503.5),  (526.5,504.0),  (526.5,505.0), 
  (526.0,505.5),  (525.5,506.0),  (525.5,507.0),  (525.0,507.5),  (524.5,508.0), 
  (524.0,508.5),  (523.5,509.0),  (523.0,509.5),  (522.5,510.0),  (522.0,510.5), 
  (521.5,511.0),  (521.5,512.0),  (521.0,512.5),  (520.5,512.0),  (520.5,511.0), 
  (520.5,510.0),  (520.5,509.0),  (520.5,508.0),  (520.5,507.0),  (520.5,506.0), 
  (520.5,505.0),  (521.0,504.5),  (521.5,504.0),  (521.5,503.0),  (521.5,502.0), 
  (521.0,501.5),  (520.5,501.0),  (520.0,500.5),  (519.5,501.0),  (519.5,502.0), 
  (519.5,503.0),  (519.5,504.0),  (519.5,505.0),  (519.0,505.5),  (518.5,506.0), 
  (518.5,507.0),  (518.5,508.0),  (518.0,508.5),  (517.5,509.0),  (517.0,509.5), 
  (516.5,510.0),  (517.0,510.5),  (517.5,511.0),  (517.5,512.0),  (517.5,513.0), 
  (517.0,513.5),  (516.5,514.0),  (516.5,515.0),  (517.0,515.5),  (517.5,516.0), 
  (517.5,517.0),  (517.0,517.5),  (516.0,517.5),  (515.0,517.5),  (514.0,517.5), 
  (513.0,517.5),  (512.0,517.5),  (511.5,518.0),  (511.0,518.5),  (510.5,518.0), 
  (510.5,517.0),  (510.5,516.0),  (510.5,515.0),  (510.5,514.0),  (510.5,513.0), 
  (510.5,512.0),  (510.5,511.0),  (510.0,510.5),  (509.5,510.0),  (509.5,509.0), 
  (509.0,508.5),  (508.5,508.0),  (508.0,507.5),  (507.5,507.0),  (507.0,506.5), 
  (506.5,506.0),  (506.0,505.5),  (505.0,505.5),  (504.5,505.0),  (504.5,504.0), 
  (504.0,503.5),  (503.5,503.0),  (503.0,502.5),  (502.0,502.5),  (501.0,502.5), 
  (500.5,502.0),  (500.0,501.5),  (499.0,501.5),  (498.0,501.5),  (497.5,502.0), 
  (498.0,502.5),  (499.0,502.5),  (499.5,503.0),  (500.0,503.5),  (501.0,503.5), 
  (501.5,504.0),  (502.0,504.5),  (502.5,505.0),  (503.0,505.5),  (503.5,506.0), 
  (504.0,506.5),  (504.5,507.0),  (505.0,507.5),  (505.5,508.0),  (506.0,508.5), 
  (506.5,509.0),  (507.0,509.5),  (507.5,510.0),  (507.5,511.0),  (507.5,512.0), 
  (507.5,513.0),  (507.5,514.0),  (507.5,515.0),  (507.5,516.0),  (507.5,517.0), 
  (507.0,517.5),  (506.5,518.0),  (506.0,518.5),  (505.5,519.0),  (505.0,519.5), 
  (504.5,519.0),  (504.5,518.0),  (504.5,517.0),  (504.0,516.5),  (503.0,516.5), 
  (502.5,516.0),  (502.0,515.5),  (501.5,515.0),  (501.0,514.5),  (500.5,514.0), 
  (500.0,513.5),  (499.0,513.5),  (498.0,513.5),  (497.0,513.5),  (496.5,513.0), 
  (496.0,512.5),  (495.5,512.0),  (495.0,511.5),  (494.0,511.5),  (493.0,511.5), 
  (492.0,511.5),  (491.0,511.5),  (490.0,511.5),  (489.5,511.0),  (489.5,510.0), 
  (489.5,509.0),  (489.0,508.5),  (488.5,508.0),  (488.0,507.5),  (487.5,507.0), 
  (487.0,506.5),  (486.0,506.5),  (485.0,506.5),  (484.5,507.0),  (484.0,507.5), 
  (483.0,507.5),  (482.5,508.0),  (483.0,508.5),  (484.0,508.5),  (484.5,509.0), 
  (485.0,509.5),  (486.0,509.5),  (486.5,510.0),  (487.0,510.5),  (487.5,511.0), 
  (487.5,512.0),  (487.0,512.5),  (486.5,513.0),  (486.5,514.0),  (487.0,514.5), 
  (488.0,514.5),  (488.5,515.0),  (489.0,515.5),  (489.5,516.0),  (489.0,516.5), 
  (488.5,517.0),  (488.0,517.5),  (487.5,518.0),  (487.0,518.5),  (486.0,518.5), 
  (485.0,518.5),  (484.5,519.0),  (484.5,520.0),  (485.0,520.5),  (486.0,520.5), 
  (487.0,520.5),  (487.5,521.0),  (488.0,521.5),  (488.5,522.0),  (488.0,522.5), 
  (487.5,523.0),  (487.0,523.5),  (486.0,523.5),  (485.5,524.0),  (485.0,524.5), 
  (484.0,524.5),  (483.5,524.0),  (483.0,523.5),  (482.0,523.5),  (481.0,523.5), 
  (480.0,523.5),  (479.0,523.5),  (478.5,523.0),  (478.0,522.5),  (477.5,523.0), 
  (477.0,523.5),  (476.5,524.0),  (476.5,525.0),  (476.5,526.0),  (476.5,527.0), 
  (476.5,528.0),  (476.5,529.0),  (476.0,529.5),  (475.5,530.0),  (475.5,531.0), 
  (475.5,532.0),  (475.5,533.0),  (475.0,533.5),  (474.5,534.0),  (474.0,534.5), 
  (473.5,535.0),  (473.5,536.0),  (473.0,536.5),  (472.5,537.0),  (472.5,538.0), 
  (472.0,538.5),  (471.5,539.0),  (471.0,539.5),  (470.0,539.5),  (469.0,539.5), 
  (468.0,539.5),  (467.0,539.5),  (466.5,540.0),  (466.0,540.5),  (465.5,541.0), 
  (465.0,541.5),  (464.5,542.0),  (464.5,543.0),  (465.0,543.5),  (465.5,543.0), 
  (466.0,542.5),  (466.5,542.0),  (467.0,541.5),  (467.5,541.0),  (468.0,540.5), 
  (469.0,540.5),  (470.0,540.5),  (471.0,540.5),  (472.0,540.5),  (472.5,540.0), 
  (473.0,539.5),  (473.5,539.0),  (474.0,538.5),  (474.5,538.0),  (475.0,537.5), 
  (475.5,537.0),  (476.0,536.5),  (476.5,536.0),  (477.0,535.5),  (477.5,535.0), 
  (477.5,534.0),  (478.0,533.5),  (478.5,533.0),  (479.0,532.5),  (480.0,532.5), 
  (480.5,533.0),  (480.5,534.0),  (480.5,535.0),  (480.5,536.0),  (481.0,536.5), 
  (482.0,536.5),  (483.0,536.5),  (484.0,536.5),  (484.5,536.0),  (484.5,535.0), 
  (485.0,534.5),  (485.5,534.0),  (485.0,533.5),  (484.5,533.0),  (484.5,532.0), 
  (484.0,531.5),  (483.0,531.5),  (482.0,531.5),  (481.0,531.5),  (480.5,531.0), 
  (480.0,530.5),  (479.5,530.0),  (479.5,529.0),  (479.0,528.5),  (478.5,528.0), 
  (479.0,527.5),  (479.5,527.0),  (480.0,526.5),  (481.0,526.5),  (481.5,527.0), 
  (482.0,527.5),  (483.0,527.5),  (483.5,528.0),  (484.0,528.5),  (484.5,529.0), 
  (485.0,529.5),  (485.5,530.0),  (486.0,530.5),  (487.0,530.5),  (487.5,530.0), 
  (488.0,529.5),  (489.0,529.5),  (490.0,529.5),  (490.5,530.0),  (491.0,530.5), 
  (491.5,530.0),  (492.0,529.5),  (492.5,529.0),  (492.5,528.0),  (493.0,527.5), 
  (493.5,527.0),  (494.0,526.5),  (495.0,526.5),  (495.5,527.0),  (496.0,527.5), 
  (496.5,528.0),  (497.0,528.5),  (497.5,529.0),  (498.0,529.5),  (499.0,529.5), 
  (500.0,529.5),  (500.5,529.0),  (500.5,528.0),  (500.5,527.0),  (500.5,526.0), 
  (500.5,525.0),  (500.5,524.0),  (500.5,523.0),  (501.0,522.5),  (502.0,522.5), 
  (503.0,522.5),  (503.5,523.0),  (503.5,524.0),  (504.0,524.5),  (504.5,525.0), 
  (505.0,525.5),  (505.5,526.0),  (505.5,527.0),  (506.0,527.5),  (506.5,528.0), 
  (506.5,529.0),  (506.5,530.0),  (507.0,530.5),  (507.5,531.0),  (507.5,532.0), 
  (508.0,532.5),  (508.5,533.0),  (509.0,533.5),  (510.0,533.5),  (510.5,534.0), 
  (511.0,534.5),  (511.5,534.0),  (511.5,533.0),  (512.0,532.5),  (512.5,532.0), 
  (513.0,531.5),  (513.5,531.0),  (513.5,530.0),  (513.5,529.0),  (513.5,528.0), 
  (513.5,527.0),  (513.5,526.0),  (513.5,525.0),  (513.5,524.0),  (514.0,523.5), 
  (515.0,523.5),  (516.0,523.5),  (517.0,523.5),  (517.5,523.0),  (518.0,522.5), 
  (519.0,522.5),  (519.5,522.0),  (520.0,521.5),  (521.0,521.5),  (521.5,521.0), 
  (522.0,520.5),  (523.0,520.5),  (523.5,520.0),  (523.5,519.0),  (523.5,518.0), 
  (523.5,517.0),  (523.5,516.0),  (524.0,515.5),  (524.5,515.0),  (525.0,514.5), 
  (525.5,514.0),  (525.5,513.0),  (526.0,512.5),  (526.5,512.0),  (527.0,511.5), 
  (528.0,511.5),  (529.0,511.5),  (530.0,511.5),  (530.5,511.0),  (530.5,510.0), 
  (530.0,509.5),  (529.5,509.0),  (529.5,508.0),  (530.0,507.5),  (530.5,507.0), 
  (530.5,506.0),  (530.5,505.0),  (530.5,504.0),  (530.5,503.0),  (531.0,502.5), 
  (532.0,502.5),  (532.5,502.0),  (532.5,501.0),  (532.5,500.0),  (532.5,499.0), 
  (533.0,498.5),  (533.5,498.0),  (533.5,497.0),  (533.5,496.0),  (533.0,495.5), 
  (532.5,495.0),  (532.5,494.0),  (532.5,493.0),  (532.5,492.0),  (532.5,491.0), 
  (532.5,490.0),  (532.5,489.0),  (532.0,488.5),  (531.5,488.0),  (531.5,487.0), 
  (531.5,486.0),  (532.0,485.5),  (532.5,485.0),  (533.0,484.5),  (534.0,484.5), 
  (535.0,484.5),  (536.0,484.5),  (537.0,484.5),  (538.0,484.5),  (539.0,484.5), 
  (539.5,485.0),  (540.0,485.5),  (540.5,486.0),  (541.0,486.5),  (541.5,487.0), 
  (541.5,488.0),  (541.5,489.0),  (541.5,490.0),  (541.5,491.0),  (541.5,492.0), 
  (542.0,492.5),  (543.0,492.5),  (543.5,493.0),  (543.5,494.0),  (544.0,494.5), 
  (544.5,495.0),  (544.5,496.0),  (544.0,496.5),  (543.5,497.0),  (543.5,498.0), 
  (543.5,499.0),  (543.5,500.0),  (543.5,501.0),  (543.5,502.0),  (543.0,502.5), 
  (542.5,503.0),  (542.5,504.0),  (542.5,505.0),  (542.0,505.5),  (541.5,506.0), 
  (541.0,506.5),  (540.5,507.0),  (540.5,508.0),  (540.0,508.5),  (539.5,509.0), 
  (539.5,510.0),  (539.5,511.0),  (539.5,512.0),  (539.5,513.0),  (540.0,513.5), 
  (540.5,514.0),  (540.5,515.0),  (540.5,516.0),  (541.0,516.5),  (541.5,517.0), 
  (541.0,517.5),  (540.5,518.0),  (540.0,518.5),  (539.0,518.5),  (538.0,518.5), 
  (537.5,518.0),  (537.0,517.5),  (536.5,517.0),  (536.0,516.5),  (535.5,516.0), 
  (535.0,515.5),  (534.5,516.0),  (534.5,517.0),  (534.5,518.0),  (534.5,519.0), 
  (534.0,519.5),  (533.5,520.0),  (533.5,521.0),  (533.5,522.0),  (533.5,523.0), 
  (534.0,523.5),  (534.5,524.0),  (535.0,524.5),  (535.5,524.0),  (535.5,523.0), 
  (536.0,522.5),  (537.0,522.5),  (538.0,522.5),  (538.5,523.0),  (539.0,523.5), 
  (540.0,523.5),  (541.0,523.5),  (542.0,523.5),  (542.5,523.0),  (543.0,522.5), 
  (543.5,522.0),  (544.0,521.5),  (544.5,521.0),  (545.0,520.5),  (545.5,520.0), 
  (545.5,519.0),  (546.0,518.5),  (546.5,518.0),  (547.0,517.5),  (547.5,518.0), 
  (548.0,518.5),  (548.5,519.0),  (548.5,520.0),  (549.0,520.5),  (549.5,521.0), 
  (549.5,522.0),  (549.5,523.0),  (549.5,524.0),  (549.5,525.0),  (549.5,526.0), 
  (549.5,527.0),  (549.5,528.0),  (549.5,529.0),  (549.5,530.0),  (549.5,531.0), 
  (549.5,532.0),  (549.5,533.0),  (549.5,534.0),  (549.5,535.0),  (549.5,536.0), 
  (549.5,537.0),  (549.5,538.0),  (549.5,539.0),  (549.5,540.0),  (549.5,541.0), 
  (550.0,541.5),  (550.5,542.0),  (550.5,543.0),  (551.0,543.5),  (551.5,544.0), 
  (552.0,544.5),  (552.5,545.0),  (553.0,545.5),  (553.5,545.0),  (554.0,544.5), 
  (554.5,544.0),  (555.0,543.5),  (555.5,543.0),  (556.0,542.5),  (556.5,542.0), 
  (557.0,541.5),  (557.5,541.0),  (558.0,540.5),  (558.5,540.0),  (559.0,539.5), 
  (559.5,539.0),  (559.5,538.0),  (559.5,537.0),  (559.5,536.0),  (560.0,535.5), 
  (560.5,535.0),  (560.5,534.0),  (561.0,533.5),  (561.5,533.0),  (562.0,532.5), 
  (563.0,532.5),  (564.0,532.5),  (565.0,532.5),  (565.5,532.0),  (565.5,531.0), 
  (566.0,530.5),  (566.5,530.0),  (567.0,529.5),  (567.5,529.0),  (568.0,528.5), 
  (568.5,528.0),  (568.5,527.0),  (568.5,526.0),  (568.5,525.0),  (568.0,524.5), 
  (567.5,524.0),  (568.0,523.5),  (568.5,523.0),  (568.5,522.0),  (568.5,521.0), 
  (569.0,520.5),  (569.5,520.0),  (570.0,519.5),  (570.5,519.0),  (571.0,518.5), 
  (571.5,518.0),  (571.0,517.5),  (570.5,517.0),  (571.0,516.5),  (571.5,516.0), 
  (572.0,515.5),  (573.0,515.5),  (574.0,515.5),  (574.5,515.0),  (575.0,514.5), 
  (576.0,514.5),  (577.0,514.5),  (578.0,514.5),  (578.5,514.0),  (579.0,513.5), 
  (579.5,513.0),  (580.0,512.5),  (580.5,512.0),  (581.0,511.5),  (582.0,511.5), 
  (582.5,511.0),  (582.5,510.0),  (582.5,509.0),  (582.5,508.0),  (582.0,507.5), 
  (581.0,507.5),  (580.0,507.5),  (579.5,507.0),  (579.5,506.0),  (579.0,505.5), 
  (578.5,505.0),  (578.0,504.5),  (577.0,504.5),  (576.5,504.0),  (576.5,503.0), 
  (576.5,502.0),  (576.5,501.0),  (577.0,500.5),  (578.0,500.5),  (579.0,500.5), 
  (579.5,500.0),  (580.0,499.5),  (580.5,499.0),  (581.0,498.5),  (582.0,498.5), 
  (582.5,498.0),  (583.0,497.5),  (584.0,497.5),  (584.5,498.0),  (585.0,498.5), 
  (585.5,498.0),  (586.0,497.5),  (586.5,497.0),  (586.5,496.0),  (587.0,495.5), 
  (588.0,495.5),  (589.0,495.5),  (590.0,495.5),  (590.5,495.0),  (590.5,494.0), 
  (590.5,493.0),  (590.5,492.0),  (591.0,491.5),  (592.0,491.5),  (592.5,491.0), 
  (593.0,490.5),  (593.5,490.0),  (593.5,489.0),  (594.0,488.5),  (594.5,488.0), 
  (595.0,487.5),  (596.0,487.5),  (597.0,487.5),  (597.5,487.0),  (598.0,486.5), 
  (599.0,486.5),  (599.5,487.0),  (599.5,488.0),  (599.5,489.0),  (599.5,490.0), 
  (599.5,491.0),  (599.5,492.0),  (599.5,493.0),  (599.5,494.0),  (599.5,495.0), 
  (599.5,496.0),  (599.5,497.0),  (599.5,498.0),  (600.0,498.5),  (601.0,498.5), 
  (601.5,499.0),  (602.0,499.5),  (602.5,500.0),  (603.0,500.5),  (603.5,501.0), 
  (603.5,502.0),  (604.0,502.5),  (604.5,503.0),  (605.0,503.5),  (606.0,503.5), 
  (606.5,504.0),  (606.5,505.0),  (607.0,505.5),  (607.5,506.0),  (607.5,507.0), 
  (607.5,508.0),  (607.5,509.0),  (608.0,509.5),  (608.5,510.0),  (608.5,511.0), 
  (608.5,512.0),  (608.5,513.0),  (608.5,514.0),  (609.0,514.5),  (610.0,514.5), 
  (611.0,514.5),  (612.0,514.5),  (613.0,514.5),  (614.0,514.5),  (614.5,515.0), 
  (614.5,516.0),  (614.5,517.0),  (614.5,518.0),  (614.5,519.0),  (614.5,520.0), 
  (614.0,520.5),  (613.5,521.0),  (613.0,521.5),  (612.5,522.0),  (612.0,522.5), 
  (611.5,523.0),  (611.5,524.0),  (611.5,525.0),  (611.5,526.0),  (611.5,527.0), 
  (611.5,528.0),  (612.0,528.5),  (612.5,529.0),  (612.5,530.0),  (612.5,531.0), 
  (612.5,532.0),  (612.5,533.0),  (612.5,534.0),  (613.0,534.5),  (613.5,535.0), 
  (614.0,535.5),  (615.0,535.5),  (615.5,536.0),  (616.0,536.5),  (616.5,537.0), 
  (617.0,537.5),  (617.5,538.0),  (618.0,538.5),  (618.5,539.0),  (618.5,540.0), 
  (619.0,540.5),  (619.5,541.0),  (620.0,541.5),  (620.5,542.0),  (621.0,542.5), 
  (622.0,542.5),  (623.0,542.5),  (623.5,543.0),  (623.0,543.5),  (622.5,544.0), 
  (622.5,545.0),  (622.5,546.0),  (622.0,546.5),  (621.5,547.0),  (621.5,548.0), 
  (621.5,549.0),  (621.5,550.0),  (621.0,550.5),  (620.5,551.0),  (620.0,551.5), 
  (619.5,552.0),  (619.0,552.5),  (618.5,553.0),  (618.5,554.0),  (618.0,554.5), 
  (617.5,555.0),  (617.5,556.0),  (617.0,556.5),  (616.5,557.0),  (616.5,558.0), 
  (616.5,559.0),  (616.0,559.5),  (615.5,560.0),  (615.5,561.0),  (615.0,561.5), 
  (614.5,562.0),  (614.5,563.0),  (614.5,564.0),  (614.5,565.0),  (614.5,566.0), 
  (614.5,567.0),  (614.5,568.0),  (614.5,569.0),  (614.5,570.0),  (615.0,570.5), 
  (615.5,571.0),  (615.5,572.0),  (616.0,572.5),  (616.5,573.0),  (616.5,574.0), 
  (617.0,574.5),  (617.5,575.0),  (618.0,575.5),  (619.0,575.5),  (619.5,576.0), 
  (620.0,576.5),  (620.5,577.0),  (620.0,577.5),  (619.0,577.5),  (618.5,578.0), 
  (619.0,578.5),  (620.0,578.5),  (621.0,578.5),  (622.0,578.5),  (622.5,578.0), 
  (622.5,577.0),  (622.0,576.5),  (621.5,576.0),  (621.0,575.5),  (620.5,575.0), 
  (620.0,574.5),  (619.5,574.0),  (619.0,573.5),  (618.5,573.0),  (618.0,572.5), 
  (617.5,572.0),  (617.5,571.0),  (617.0,570.5),  (616.5,570.0),  (616.0,569.5), 
  (615.5,569.0),  (616.0,568.5),  (616.5,568.0),  (616.5,567.0),  (617.0,566.5), 
  (617.5,566.0),  (618.0,565.5),  (618.5,565.0),  (618.5,564.0),  (618.5,563.0), 
  (619.0,562.5),  (620.0,562.5),  (621.0,562.5),  (622.0,562.5),  (622.5,563.0), 
  (623.0,563.5),  (624.0,563.5),  (624.5,563.0),  (625.0,562.5),  (625.5,562.0), 
  (625.5,561.0),  (625.5,560.0),  (625.5,559.0),  (625.5,558.0),  (626.0,557.5), 
  (626.5,557.0),  (627.0,556.5),  (628.0,556.5),  (629.0,556.5),  (630.0,556.5), 
  (631.0,556.5),  (632.0,556.5),  (633.0,556.5),  (633.5,556.0),  (634.0,555.5), 
  (634.5,556.0),  (635.0,556.5),  (636.0,556.5),  (636.5,557.0),  (637.0,557.5), 
  (638.0,557.5),  (639.0,557.5),  (639.5,558.0),  (640.0,558.5),  (641.0,558.5), 
  (642.0,558.5),  (642.5,558.0),  (642.5,557.0),  (642.0,556.5),  (641.5,556.0), 
  (641.0,555.5),  (640.0,555.5),  (639.5,555.0),  (639.5,554.0),  (639.0,553.5), 
  (638.5,553.0),  (638.0,552.5),  (637.5,552.0),  (638.0,551.5),  (639.0,551.5), 
  (639.5,552.0),  (640.0,552.5),  (640.5,552.0),  (640.5,551.0),  (640.5,550.0), 
  (641.0,549.5),  (641.5,549.0),  (641.5,548.0),  (642.0,547.5),  (642.5,547.0), 
  (642.5,546.0),  (642.5,545.0),  (643.0,544.5),  (643.5,544.0),  (644.0,543.5), 
  (644.5,543.0),  (644.5,542.0),  (645.0,541.5),  (645.5,541.0),  (645.5,540.0), 
  (646.0,539.5),  (646.5,539.0),  (647.0,538.5),  (647.5,538.0),  (647.5,537.0), 
  (648.0,536.5),  (649.0,536.5),  (649.5,536.0),  (649.5,535.0),  (650.0,534.5), 
  (650.5,534.0),  (650.5,533.0),  (651.0,532.5),  (651.5,532.0),  (651.0,531.5), 
  (650.5,531.0),  (651.0,530.5),  (652.0,530.5),  (652.5,530.0),  (652.5,529.0), 
  (652.5,528.0),  (653.0,527.5),  (654.0,527.5),  (654.5,527.0),  (655.0,526.5), 
  (656.0,526.5),  (656.5,526.0),  (656.5,525.0),  (656.5,524.0),  (657.0,523.5), 
  (657.5,523.0),  (657.5,522.0),  (658.0,521.5),  (658.5,521.0),  (658.5,520.0), 
  (659.0,519.5),  (659.5,519.0),  (659.5,518.0),  (659.5,517.0),  (659.5,516.0), 
  (659.5,515.0),  (660.0,514.5),  (660.5,514.0),  (660.5,513.0),  (660.5,512.0), 
  (660.5,511.0),  (661.0,510.5),  (661.5,510.0), 
]
    
    print("üöÄ FIXED DIVIDED SPLINE COMPRESSION TEST")
    print("=" * 50)
    
    # Parameters - start with fewer sublists
    num_sublists = 50  # Start with 2 instead of 3
    compression_ratio = 0.3  # Use more conservative compression
    
    # Use the fixed version
    #result = compress_sublist_with_continuity(sample_coordinates, num_sublists, compression_ratio)
    result = compress_shape_divided_exact(sample_coordinates, num_sublists, compression_ratio)
    
    if result:
        # Print analysis
        print_divided_compression_analysis(result)
        
        overall = result['overall_metrics']
        print(f"\nüéØ FINAL RESULTS:")
        print(f"  Original points: {overall['total_original_points']}")
        print(f"  Key points: {overall['total_key_points']}")
        print(f"  Target ratio: {overall['compression_ratio']:.1%}")
        print(f"  Actual ratio: {overall['actual_compression_ratio']:.1%}")
        print(f"  Storage reduction: {overall['storage_reduction']}")
        print(f"  Reconstruction error: {overall['mean_error']:.6f}")

        visualize_divided_compression(sample_coordinates, result)
        
        # 1. Get optimal minimal storage (3 decimal places as requested)
        print("\n" + "="*60)
        print("üíæ MINIMAL STORAGE WITH ROUNDING")
        print("="*60)
        
        compressed_data, storage_info = get_minimal_storage_with_rounding(
            result, decimal_places=3
        )
        
        print(f"Original data:")
        print(f"  - Points: {storage_info['original_points']:,}")
        print(f"  - Size: {storage_info['original_size_bytes']:,} bytes")
        
        print(f"\nCompressed data (rounded to 3 decimals):")
        print(f"  - Points: {storage_info['compressed_points']:,}")
        print(f"  - Size: {storage_info['rounded_size_bytes']:,} bytes")
        print(f"  - Compression ratio: {storage_info['compression_ratio']:.1%}")
        print(f"  - Storage reduction: {storage_info['storage_reduction']:.1f}%")
        
        # 3. Reconstruct from compressed data
        print("\n" + "="*60)
        print("üîÑ RECONSTRUCTION FROM COMPRESSED DATA")
        print("="*60)
        
        # Use the EXACT same number of points as original for reconstruction
        reconstructed_boundary, spline_data = reconstruct_from_minimal_storage(
            compressed_data, 
            num_points=storage_info['original_points']  # This is key!
        )
        
        # Get original boundary - ensure we have the right one
        original_boundary = result['combined_reconstructed']
        
        # Ensure both arrays have the same length
        min_length = min(len(original_boundary), len(reconstructed_boundary))
        original_boundary = original_boundary[:min_length]
        reconstructed_boundary = reconstructed_boundary[:min_length]
        
        print(f"Length check - Original: {len(original_boundary)}, Reconstructed: {len(reconstructed_boundary)}")
        
        # Calculate final reconstruction quality
        final_error = np.mean(np.sqrt(
            (reconstructed_boundary[:, 0] - original_boundary[:, 0])**2 + 
            (reconstructed_boundary[:, 1] - original_boundary[:, 1])**2
        ))
        
        print(f"Reconstruction quality:")
        print(f"  - Original points: {len(original_boundary)}")
        print(f"  - Reconstructed points: {len(reconstructed_boundary)}")
        print(f"  - Reconstruction error: {final_error:.6f}")
        
        # 4. Visualize the results
        print("\n" + "="*60)
        print("üìä VISUALIZATION")
        print("="*60)
        
        visualize_minimal_storage_results(
            original_boundary, 
            compressed_data, 
            reconstructed_boundary, 
            storage_info
        )



        compressed_matrix=compressed_data

        original_boundary = result['combined_reconstructed']
        
        # Save the matrix
        save_compressed_matrix(compressed_matrix, "compressed_boundary")
        
        # Demonstrate reconstruction
        reconstructed, loaded_matrix = load_and_reconstruct("compressed_boundary", storage_info['original_points'])
        
        # Final analysis
        analyze_final_storage(result['combined_reconstructed'], compressed_matrix)

        # Ensure same length for comparison
        min_length = min(len(original_boundary), len(reconstructed))
        original_boundary = original_boundary[:min_length]
        reconstructed = reconstructed[:min_length]
        
        # Show all visualizations
        visualize_reconstruction_comparison(original_boundary, compressed_matrix, reconstructed)
        visualize_reconstruction_overlay(original_boundary, compressed_matrix, reconstructed)
        visualize_quality_metrics(original_boundary, reconstructed)

    

    else:
        print("‚ùå Compression failed!")
